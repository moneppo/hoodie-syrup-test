$(function () {
    var sync = _.partial(couchr.put, '/_api/_plugins/syrup/_api/generate');

    function updateManifest(text) {
      var code = text.replace(/\n/g, '<br/>');
      $('[name=manifest]').html('<code>' + code + '</code>');
    }

    $('#reset').click(function (ev) {
        $('[name=manifest]').html('<img src="assets/images/loading32.gif"></img>');
        sync(function(err, doc) {
          if (err) {
            alert("Error trying to sync");
          }

          var text = JSON.parse(doc).manifest;
          updateManifest(text);
        });
    });
});
